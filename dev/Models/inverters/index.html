<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Inverter · PowerSimulationsDynamics.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="PowerSimulationsDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">PowerSimulationsDynamics.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><a class="tocitem" href="../../tutorials_page/">Tutorials</a></li><li><span class="tocitem">Models</span><ul><li><a class="tocitem" href="../network/">Network</a></li><li><a class="tocitem" href="../srf/">Reference Frames</a></li><li><a class="tocitem" href="../gens/">Generator</a></li><li class="is-active"><a class="tocitem" href>Inverter</a><ul class="internal"><li><a class="tocitem" href="#DC-Source"><span>DC Source</span></a></li><li><a class="tocitem" href="#Frequency-Estimators"><span>Frequency Estimators</span></a></li><li><a class="tocitem" href="#Outer-Loop-Controls"><span>Outer Loop Controls</span></a></li><li><a class="tocitem" href="#Inner-Loop-Controls"><span>Inner Loop Controls</span></a></li><li><a class="tocitem" href="#Converter"><span>Converter</span></a></li><li><a class="tocitem" href="#Filters"><span>Filters</span></a></li><li><a class="tocitem" href="#Reference"><span>Reference</span></a></li></ul></li><li><a class="tocitem" href="../small/">Small Signal</a></li></ul></li><li><a class="tocitem" href="../../api/public/">Public API Reference</a></li><li><a class="tocitem" href="../../api/internal/">Internal API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Models</a></li><li class="is-active"><a href>Inverter</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Inverter</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-SIIP/PowerSimulationsDynamics.jl/blob/master/docs/src/Models/inverters.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Inverter-Models"><a class="docs-heading-anchor" href="#Inverter-Models">Inverter Models</a><a id="Inverter-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Inverter-Models" title="Permalink"></a></h1><p>Here we discuss the structure and models used to model inverters in PowerSimulationsDynamics.jl. Each inverter is a data structure that is defined by the following components:</p><ul><li>DC Source: Defines the dynamics of the DC side of the converter.</li><li>Frequency Estimator: That describes how the frequency of the grid can be estimated using the grid voltages. Typically a phase-locked loop (PLL).</li><li>Outer Loop Control: That describes the active and reactive power control dynamics.</li><li>Inner Loop Control: That can describe virtual impedance, voltage control and current control dynamics.</li><li>Converter: That describes the dynamics of the pulse width modulation (PWM) or space vector modulation (SVM).</li><li>Filter: Used to connect the converter output to the grid.</li></ul><p>The following figure summarizes the components of a inverter and which variables they share:</p><img src="../../assets/inv_metamodel.png" width="75%"/><p>⠀</p><p>Contrary to the generator, there are many control structures that can be used to model inverter controllers (e.g. grid-following, grid feeding or virtual synchronous machine). For this purpose, more variables are shared among the components in order to cover all these posibilities.</p><p>Models are based from the paper: &quot;A Virtual Synchronous Machine implementation for distributed control of power converters in SmartGrids&quot; from S. D&#39;Arco, J.A. Suul and O.B. Fosso, and structures are defined in <code>PowerSystems.jl</code> abbreviated as <code>PSY</code>.</p><h2 id="DC-Source"><a class="docs-heading-anchor" href="#DC-Source">DC Source</a><a id="DC-Source-1"></a><a class="docs-heading-anchor-permalink" href="#DC-Source" title="Permalink"></a></h2><p>This component can be used to model the dynamics of the DC side of the converter.</p><h3 id="Fixed-DC-Source-[FixedDCSource]"><a class="docs-heading-anchor" href="#Fixed-DC-Source-[FixedDCSource]">Fixed DC Source <code>[FixedDCSource]</code></a><a id="Fixed-DC-Source-[FixedDCSource]-1"></a><a class="docs-heading-anchor-permalink" href="#Fixed-DC-Source-[FixedDCSource]" title="Permalink"></a></h3><p>This is a model that set the DC voltage to a fixed value <span>$v_{\text{dc}} = v_{\text{dc}}^{\text{fix}}$</span>.</p><h2 id="Frequency-Estimators"><a class="docs-heading-anchor" href="#Frequency-Estimators">Frequency Estimators</a><a id="Frequency-Estimators-1"></a><a class="docs-heading-anchor-permalink" href="#Frequency-Estimators" title="Permalink"></a></h2><p>This component is used to estimate the frequency of the grid based on the voltage at the bus.</p><h3 id="Phase-Locked-Loop-(PLL)-for-VSM-[KauraPLL]"><a class="docs-heading-anchor" href="#Phase-Locked-Loop-(PLL)-for-VSM-[KauraPLL]">Phase-Locked Loop (PLL) for VSM <code>[KauraPLL]</code></a><a id="Phase-Locked-Loop-(PLL)-for-VSM-[KauraPLL]-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Locked-Loop-(PLL)-for-VSM-[KauraPLL]" title="Permalink"></a></h3><p>The following equations present a PLL used to estimate the frequency and PLL angle of the grid. There are two reference frames considered in this inverter. Those are the VSM of the outer-loop control <span>$\delta\theta_{\text{olc}}$</span> and the PLL one <span>$\delta\theta_{\text{pll}}$</span>. The notation used a <span>$\delta\theta$</span> to refer as the variation of the respective angle <span>$\theta$</span> with respect to the grid SRF (instead of the fixed <span>$\alpha$</span> component of the <span>$\alpha\beta$</span> transformation):</p><div>\[\begin{align}

\dot{v}_{d,\text{pll}} &amp;= \omega_{\text{lp}} \left [v_{d,\text{out}} - v_{d,\text{pll}} \right] \tag{1a} \\
\dot{v}_{q,\text{pll}} &amp;= \omega_{\text{lp}} \left [v_{q,\text{out}} - v_{q,\text{pll}} \right] \tag{1b} \\
\dot{\varepsilon}_{\text{pll}} &amp;= \tan^{-1}\left(\frac{v_{q,\text{pll}}}{v_{d,\text{pll}}} \right) \tag{1c} \\
\dot{\delta\theta}_{\text{pll}} &amp;= \Omega_b \delta \omega_{\text{pll}} \tag{1d}
\end{align}\]</div><p>with</p><div>\[\begin{align}
\delta\omega_{\text{pll}} &amp;= k_{p,\text{pll}} \tan^{-1} \left(\frac{v_{q,\text{pll}}}{v_{d,\text{pll}}} \right) + k_{i,\text{pll}} \varepsilon_{\text{pll}} \tag{1e} \\
v_{d,\text{out}} + jv_{q,\text{out}} &amp;= (v_r + jv_i)e^{-\delta\theta_\text{pll}}  \tag{1f}
\end{align}\]</div><p>on which <span>$v_r + jv_i$</span> is the voltage in the grid reference frame on which the PLL is measuring (i.e. point of common coupling), that could be in the capacitor of an LCL filter or the last branch of such filter.</p><h2 id="Outer-Loop-Controls"><a class="docs-heading-anchor" href="#Outer-Loop-Controls">Outer Loop Controls</a><a id="Outer-Loop-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Outer-Loop-Controls" title="Permalink"></a></h2><p>This component defines controllers for both active and reactive power</p><h3 id="Virtual-Inertia-and-Q-droop-[OuterControl]"><a class="docs-heading-anchor" href="#Virtual-Inertia-and-Q-droop-[OuterControl]">Virtual Inertia and Q-droop <code>[OuterControl]</code></a><a id="Virtual-Inertia-and-Q-droop-[OuterControl]-1"></a><a class="docs-heading-anchor-permalink" href="#Virtual-Inertia-and-Q-droop-[OuterControl]" title="Permalink"></a></h3><p>The following model represent a virtual synchronous machine model to represent how active power is going to be deployed. The constructor is <code>OuterControl{VirtualInertia, ReactivePowerDroop}</code>. It defines a new SRF denoted as <span>$\theta_{\text{olc}}$</span> for the active power controller and uses a simple voltage droop for dispatching reactive power:</p><div>\[\begin{align}
    \dot{\delta\omega}_{\text{olc}} &amp;= \frac{p_{\text{ref}}}{T_a} - \frac{p_e}{T_a} - \frac{k_d(\omega_{\text{olc}} - \omega_{\text{pll}})}{T_a} - \frac{k_\omega(\omega_{\text{olc}} - \omega_{\text{ref}})}{T_a} \tag{2a} \\
    \dot{\delta\theta}_{\text{olc}} &amp;= \Omega_b \delta\omega_{\text{olc}} \tag{2b} \\
    \dot{q}_m &amp;= \omega_f (q_e - q_m) \tag{2c}
\end{align}\]</div><p>with</p><div>\[\begin{align}
    p_e &amp;= v_ri_r + v_ii_i \tag{2d} \\
    q_e &amp;= v_ii_r - v_ri_i \tag{2e} \\
    v_{\text{olc}}^{\text{ref}} &amp;= v_{\text{ref}} + k_q(q_{\text{ref}} - q_m) \tag{2f}
\end{align}\]</div><p>In this case, the measurement of power are being done in the capacitor of the LCL filter. However, depending on the model, this measurements could be different depending on where is the point of common coupling.</p><h2 id="Inner-Loop-Controls"><a class="docs-heading-anchor" href="#Inner-Loop-Controls">Inner Loop Controls</a><a id="Inner-Loop-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Inner-Loop-Controls" title="Permalink"></a></h2><p>This component defines voltage and current controllers to generate the reference signal for the converter.</p><h3 id="Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[CurrentControl]"><a class="docs-heading-anchor" href="#Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[CurrentControl]">Integrated Virtual Impedance, Voltage and Current Controller <code>[CurrentControl]</code></a><a id="Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[CurrentControl]-1"></a><a class="docs-heading-anchor-permalink" href="#Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[CurrentControl]" title="Permalink"></a></h3><p>The following model receives both the outer loop control frequency and reference voltage signal to generate the reference signal for the converters. The virtual impedance plays a similar role of the impedance of a synchronous generator. A PI voltage controller is used to generate the current signal that is used in the PI current controller to finally generate the voltage reference signal for the converters.</p><div>\[\begin{align*}
    \dot{\xi}_d &amp;= v_{d,\text{vi}}^{\text{ref}} - v_d \tag{3a} \\
    \dot{\xi}_q &amp;= v_{q,\text{vi}}^{\text{ref}} - v_q \tag{3b} \\
    \dot{\gamma}_d &amp;= i_{d,\text{cv}}^{\text{ref}} - i_{d,\text{cv}} \tag{3c} \\
    \dot{\gamma}_q &amp;= i_{q,\text{cv}}^{\text{ref}} - i_{q,\text{cv}} \tag{3d} \\
    \dot{\phi}_d &amp;= \omega_{\text{ad}}(v_d - \phi_d) \tag{3e} \\
    \dot{\phi}_q &amp;= \omega_{\text{ad}}(v_q - \phi_q) \tag{3f}
\end{align*}\]</div><p>with</p><div>\[\begin{align}
    v_{d,\text{vi}}^{\text{ref}} &amp;= v_{\text{olc}}^{\text{ref}} - r_v i_d + \omega_{\text{olc}} l_v i_q \tag{3g} \\
    v_{q,\text{vi}}^{\text{ref}} &amp;= - r_v i_q - \omega_{\text{olc}} l_v i_d \tag{3h} \\
    i_{d,\text{cv}}^{\text{ref}} &amp;= k_{pv}\left(v_{d,\text{vi}}^{\text{ref}} - v_q\right) + k_{iv} \xi_d - c_f \omega_{\text{olc}} v_q + k_{\text{ffi}}i_d \tag{3i} \\
    i_{q,\text{cv}}^{\text{ref}} &amp;= k_{pv}\left(v_{q,\text{vi}}^{\text{ref}} - v_q\right) + k_{iv} \xi_q + c_f \omega_{\text{olc}} v_d + k_{\text{ffi}}i_q \tag{3j} \\
    v_d^{\text{ref-signal}} &amp;= k_{pc} \left(i_{d,\text{cv}}^{\text{ref}} - i_{d,\text{cv}}\right) + k_{ic} \gamma_d - \omega_{\text{olc}} l_f i_{q,\text{cv}} + k_{\text{ffv}}v_d - k_{\text{ad}}(v_d - \phi_d) \tag{3k} \\
    v_q^{\text{ref-signal}} &amp;= k_{pc} \left(i_{q,\text{cv}}^{\text{ref}} - i_{q,\text{cv}}\right) + k_{ic} \gamma_q + \omega_{\text{olc}} l_f i_{d,\text{cv}} + k_{\text{ffv}}v_q - k_{\text{ad}}(v_q - \phi_q) \tag{3l}
\end{align}\]</div><p>In here the transformation to the <span>$dq$</span> reference frame is using the outer-loop reference angle as:</p><div>\[\begin{align*}
v_d + jv_q = (v_r + jv_i)e^{-j\delta\theta_{olc}} \\
i_d + ji_q = (i_r + ji_i)e^{-j\delta\theta_{olc}} 
\end{align*}\]</div><p>that again <span>$v_r + jv_i$</span> could be in the capacitor or the last branch of the filter (i.e. the point of common coupling). For LCL filters it is considered in the capacitor. In the case of the converter, the transformation is directly</p><div>\[\begin{align*}
i_{d,\text{cv}} + ji_{q,\text{cv}} = (i_{r,\text{cv}} + ji_{i,\text{cv}})e^{-j\delta\theta_{olc}}
\end{align*}\]</div><h2 id="Converter"><a class="docs-heading-anchor" href="#Converter">Converter</a><a id="Converter-1"></a><a class="docs-heading-anchor-permalink" href="#Converter" title="Permalink"></a></h2><p>This component can be used to model the dynamics of the switching process.</p><h3 id="Average-Model-[AverageConverter]"><a class="docs-heading-anchor" href="#Average-Model-[AverageConverter]">Average Model <code>[AverageConverter]</code></a><a id="Average-Model-[AverageConverter]-1"></a><a class="docs-heading-anchor-permalink" href="#Average-Model-[AverageConverter]" title="Permalink"></a></h3><p>The average model simply output the desired reference signal since:</p><div>\[\begin{align}
v_{d}^{\text{cv}} \approx m_{d} v_{\text{dc}} \approx \frac{v_{d}^{\text{ref-signal}}}{v_{\text{dc}}} v_{\text{dc}} \approx v_{d}^{\text{ref-signal}} \tag{4a} \\
v_{q}^{\text{cv}} \approx m_{q} v_{\text{dc}} \approx \frac{v_{q}^{\text{ref-signal}}}{v_{\text{dc}}} v_{\text{dc}} \approx v_{q}^{\text{ref-signal}} \tag{4b}
\end{align}\]</div><p>where <span>$m_{dq}$</span> is the modulation signal, and <span>$v_{dq}^{\text{ref-signal}}$</span> is the voltage reference signal from the inner loop control.</p><h2 id="Filters"><a class="docs-heading-anchor" href="#Filters">Filters</a><a id="Filters-1"></a><a class="docs-heading-anchor-permalink" href="#Filters" title="Permalink"></a></h2><h3 id="LCL-Filter-[LCLFilter]"><a class="docs-heading-anchor" href="#LCL-Filter-[LCLFilter]">LCL Filter <code>[LCLFilter]</code></a><a id="LCL-Filter-[LCLFilter]-1"></a><a class="docs-heading-anchor-permalink" href="#LCL-Filter-[LCLFilter]" title="Permalink"></a></h3><p>A standard LCL filter is proposed to connect the output of the converter to the grid. In this case, <span>$v_r$</span> and <span>$v_i$</span> are voltages in the capacitor, while <span>$v_r^{\text{grid}}$</span> and <span>$v_i^{\text{grid}}$</span> represent the voltage at the bus. The L filter after the capacitor can also include a step-up transformer to increase the voltage, that is model as an extra impedance.</p><div>\[\begin{align}
    \dot{i}_{r,\text{cv}} &amp;= \frac{\Omega_b}{l_f}\left( v_r^{\text{cv}} - v_r  - r_f i_{r,\text{cv}} + \omega_{\text{grid}} l_f i_{i,\text{cv}} \right) \tag{5a} \\
    \dot{i}_{i,\text{cv}} &amp;= \frac{\Omega_b}{l_f}\left( v_i^{\text{cv}} - v_i  - r_f i_{i,\text{cv}} - \omega_{\text{grid}} l_f i_{r,\text{cv}} \right) \tag{5b} \\
    \dot{v}_{r} &amp;=  \frac{\Omega_b}{c_f}\left( i_r^{\text{cv}} - i_r + \omega_{\text{grid}} c_f v_i \right) \tag{5c} \\
    \dot{v}_{i} &amp;=  \frac{\Omega_b}{c_f}\left( i_i^{\text{cv}} - i_i - \omega_{\text{grid}} c_f v_r \right) \tag{5d} \\
    \dot{i}_{r} &amp;= \frac{\Omega_b}{l_g}\left( v_r^{\text{cv}} - v_r^{\text{grid}} - r_g i_{r} + \omega_{\text{grid}} l_g i_{i,\text{cv}} \right) \tag{5e} \\
    \dot{i}_{i} &amp;= \frac{\Omega_b}{l_g}\left( v_i^{\text{cv}} - v_i^{\text{grid}} - r_g i_{i} - \omega_{\text{grid}} l_g i_{r,\text{cv}} \right) \tag{5f}
\end{align}\]</div><p>on which </p><div>\[\begin{align*}
v_r^\text{cv} + jv_i^\text{cv} = (v_d^\text{cv} + jv_q^\text{cv})e^{j\delta\theta_{olc}}
\end{align*}\]</div><p>that comes from the converter model.</p><h2 id="Reference"><a class="docs-heading-anchor" href="#Reference">Reference</a><a id="Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Reference" title="Permalink"></a></h2><p>For constructors check the API on <a href="https://nrel.github.io/PowerSystems.jl/latest/api/PowerSystems/">PowerSystems.jl documentation</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gens/">« Generator</a><a class="docs-footer-nextpage" href="../small/">Small Signal »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 20 November 2020 02:21">Friday 20 November 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
